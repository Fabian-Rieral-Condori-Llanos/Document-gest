const mongoose = require('mongoose');
const Schema = mongoose.Schema;

/**
 * VulnerabilityType Model
 * 
 * Define los tipos de vulnerabilidad disponibles.
 * La lógica de negocio está en services/vulnerability-type.service.js
 */

const VulnerabilityTypeSchema = new Schema({
    name: {
        type: String,
        required: [true, 'Vulnerability type name is required'],
        maxlength: [255, 'Name cannot exceed 255 characters']
    },
    locale: {
        type: String,
        required: [true, 'Locale is required'],
        maxlength: [10, 'Locale cannot exceed 10 characters']
    },
    order: {
        type: Number,
        default: 0
    }
}, {
    timestamps: true,
    toJSON: {
        transform: function(doc, ret) {
            delete ret.__v;
            return ret;
        }
    }
});

/**
 * Índices - nombre + locale debe ser único
 */
VulnerabilityTypeSchema.index({ name: 1, locale: 1 }, { name: 'unique_name_locale', unique: true });
VulnerabilityTypeSchema.index({ order: 1 });

/**
 * Campos para listados
 */
VulnerabilityTypeSchema.statics.listFields = '-_id name locale';

const VulnerabilityType = mongoose.model('VulnerabilityType', VulnerabilityTypeSchema);

module.exports = VulnerabilityType;
