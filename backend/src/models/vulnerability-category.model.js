const mongoose = require('mongoose');
const Schema = mongoose.Schema;

/**
 * VulnerabilityCategory Model
 * 
 * Define las categorías de vulnerabilidad.
 * La lógica de negocio está en services/vulnerability-category.service.js
 */

const VulnerabilityCategorySchema = new Schema({
    name: {
        type: String,
        unique: true,
        required: [true, 'Category name is required'],
        maxlength: [255, 'Name cannot exceed 255 characters']
    },
    sortValue: {
        type: String,
        default: 'cvssScore',
        maxlength: [50, 'Sort value cannot exceed 50 characters']
    },
    sortOrder: {
        type: String,
        enum: ['desc', 'asc'],
        default: 'desc'
    },
    sortAuto: {
        type: Boolean,
        default: true
    },
    order: {
        type: Number,
        default: 0
    }
}, {
    timestamps: true,
    toJSON: {
        transform: function(doc, ret) {
            delete ret.__v;
            return ret;
        }
    }
});

/**
 * Índices
 */
VulnerabilityCategorySchema.index({ order: 1 });

/**
 * Campos para listados
 */
VulnerabilityCategorySchema.statics.listFields = 'name sortValue sortOrder sortAuto';

const VulnerabilityCategory = mongoose.model('VulnerabilityCategory', VulnerabilityCategorySchema);

module.exports = VulnerabilityCategory;
